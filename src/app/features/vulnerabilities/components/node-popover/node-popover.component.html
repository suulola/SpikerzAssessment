@if (isOpen()) {
  <div
    class="fixed z-9999 -translate-x-1/2 origin-top scale-100 lg:scale-90"
    [style.left.px]="popoverPosition()?.x"
    [style.top.px]="popoverPosition()?.y"
    (click)="onPopoverClick($event)"
    (mouseenter)="onPopoverEnter($event)"
    (mouseleave)="onPopoverLeave()"
  >
    @if (selectedNode()?.popoverData?.variant === 'perimeter') {
      <div class="h-auto min-h-168 w-full max-w-popover-mobile rounded-sm bg-gray-soft-25 shadow-popover-md lg:w-460 lg:max-w-460">
        <div class="h-full px-7.5 pt-5.25 font-mono text-md leading-popover tracking-base overflow-x-auto">
          <div class="inline-flex items-center gap-2.5 px-2.5 py-0.5 bg-red-50 rounded-pill w-216">
            <span class="font-semibold text-red-700">
              {{ selectedNode()?.popoverData?.title }}
            </span>
          </div>

          <div class="mt-3.5 ml-12.75 grid grid-cols-popover-chips gap-0.75">
            @for (vuln of selectedNode()?.popoverData?.vulnerabilities; track $index) {
              <div class="inline-flex items-center justify-center gap-2.5 px-2.5 py-0.5 bg-red-50 rounded-pill w-full min-w-0">
                <span class="font-semibold text-red-700 block truncate max-w-full">
                  {{ vuln }}
                </span>
              </div>
            }
          </div>

          @if (selectedNode()?.popoverData?.metadata) {
            <div class="mt-3.5 inline-flex items-center gap-2.5 px-1 py-0.5 bg-purple-50 rounded-pill w-fit max-w-full">
              <span class="font-semibold text-purple-600 block truncate max-w-full">
                {{ selectedNode()?.popoverData?.metadata?.label }}: {{ selectedNode()?.popoverData?.metadata?.value }}
              </span>
            </div>
          }
        </div>
      </div>
    } @else {
      <div class="inline-flex w-full max-w-popover-mobile flex-col gap-3 rounded-sm bg-gray-soft-25 shadow-popover-md lg:w-fit">
        <div class="px-4 py-2.5">
          <div class="flex flex-col gap-1.25">
            <div class="flex items-center gap-3.625">
              <img
                [src]="selectedNode()?.popoverData?.header?.icon"
                alt=""
                class="h-39.69 w-39.69"
              />
              <span class="text-md font-semibold leading-104 text-gray-soft-700">
                {{ selectedNode()?.popoverData?.header?.title }}
              </span>
            </div>

            @for (row of selectedNode()?.popoverData?.rows; track $index) {
              <div
                class="flex items-center gap-1.25"
                [class.gap-3.625]="row.gap === 'wide'"
              >
                @for (item of row.items; track $index) {
                  @switch (item.type) {
                    @case ('icon') {
                      <img [src]="item.icon" alt="" class="h-15 w-15" />
                    }
                    @case ('text') {
                      @switch (item.textStyle) {
                        @case ('label') {
                          <span class="text-md font-semibold leading-104 text-gray-soft-700">
                            {{ item.value }}
                          </span>
                        }
                        @case ('title') {
                          <span class="text-base font-bold leading-146 tracking-base text-gray-soft-700">
                            {{ item.value }}
                          </span>
                        }
                        @default {
                          <span class="text-base font-semibold leading-146 tracking-base text-gray-soft-700">
                            {{ item.value }}
                          </span>
                        }
                      }
                    }
                    @case ('chip') {
                      <span
                        class="inline-flex items-center justify-center gap-2.5 rounded-pill px-1 py-0.5 font-mono text-md font-semibold leading-popover tracking-base"
                        [class.bg-purple-50]="item.tone === 'purple'"
                        [class.text-purple-600]="item.tone === 'purple'"
                        [class.bg-yellow-50]="item.tone === 'yellow'"
                        [class.text-yellow-600]="item.tone === 'yellow'"
                        [class.bg-green-50]="item.tone === 'green'"
                        [class.text-green-700]="item.tone === 'green'"
                        [class.bg-blue-50]="item.tone === 'blue'"
                        [class.text-blue-700]="item.tone === 'blue'"
                      >
                        {{ item.value }}
                      </span>
                    }
                  }
                }
              </div>
            }
          </div>
        </div>
      </div>
    }
  </div>
}
