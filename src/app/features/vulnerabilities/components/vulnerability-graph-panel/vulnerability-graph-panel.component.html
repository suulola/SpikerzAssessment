<section
  class="flex lg:h-full flex-col gap-5 overflow-y-visible rounded-lg border border-gray-soft-50 bg-white px-4 md:px-7.5 py-5 shadow-xs lg:overflow-y-auto"
>
  <h2 class="graph-panel__title">Attack Path Overview</h2>

  <div class="flex flex-col gap-2.5 rounded-lg bg-gray-soft-25 px-4 py-2.5">
    <app-graph-visualization />

    <div class="flex flex-wrap items-center gap-2 md:gap-3">
      @for (item of legendItems; track item.label) {
      <div
        class="inline-flex items-center gap-2 rounded-full px-2 py-0.5 text-sm font-bold leading-146 tracking-base text-gray-soft-700 md:px-3 md:py-1 md:text-base"
        [class.bg-red-50]="item.toneClass === 'graph-panel__legend-chip--critical'"
        [class.text-red-700]="item.toneClass === 'graph-panel__legend-chip--critical'"
        [class.bg-gray-soft-25]="item.toneClass === 'graph-panel__legend-chip--warning'"
        [class.text-orange-600]="item.toneClass === 'graph-panel__legend-chip--warning'"
        [class.bg-green-50]="item.toneClass === 'graph-panel__legend-chip--ok'"
        [class.text-green-700]="item.toneClass === 'graph-panel__legend-chip--ok'"
      >
          <img [src]="item.icon" alt="" class="graph-panel__legend-icon" />
          <span>{{ item.label }}</span>
        </div>
      }
    </div>
  </div>

  <h3 class="graph-panel__section-title">Assets & Contextual Risk</h3>

  <div class="grid w-full auto-rows-fr grid-cols-1 gap-5 xl:grid-cols-2">
    <div class="flex w-full flex-col rounded-lg border border-gray-soft-50 bg-white shadow-xs">
      <div class="graph-panel__table flex flex-1">
        <div class="flex w-full flex-col">
          <div class="border-b border-gray-soft-100 px-6 py-3 text-md font-normal leading-104 text-gray-soft-400">
            Asset
          </div>

          @for (asset of pagedAssets(); track asset.name) {
            <div class="flex flex-1 items-center border-b border-gray-soft-100 px-2.5 py-4">
              <div class="flex items-center gap-3">
                <img [src]="asset.icon" alt="" class="graph-panel__asset-icon" />
                <div class="flex flex-col gap-1">
                  <span class="text-md font-semibold leading-146 text-gray-soft-700">{{ asset.name }}</span>
                  <span class="text-xs font-medium leading-104 text-gray-soft-500">{{ asset.ip }}</span>
                </div>
              </div>
            </div>
          }
        </div>

        <div class="flex w-full flex-col">
          <div class="border-b border-gray-soft-100 px-6 py-3 text-center text-md font-normal leading-104 text-gray-soft-400">
            Contextual Risk
          </div>

          @for (asset of pagedAssets(); track asset.name) {
            <div class="flex flex-1 items-center justify-center border-b border-gray-soft-100 px-2.5 py-4">
              <span class="graph-panel__risk-pill inline-flex items-center gap-2 bg-red-100 px-4 py-1 text-base font-bold leading-146 tracking-base text-red-800">
                {{ asset.risk }}
              </span>
            </div>
          }
        </div>
      </div>

      <div class="flex items-center justify-center gap-2.5 py-3 text-md font-normal leading-146 text-gray-soft-500">
        <button
          type="button"
          class="inline-flex items-center justify-center border-0 bg-transparent p-0 transition-opacity duration-150 disabled:cursor-default disabled:opacity-40"
          (click)="prevPage()"
          [disabled]="!canGoPrev()"
          aria-label="Previous page"
        >
          <img src="assets/icons/graph/pagination-chevron-left.svg" alt="" class="h-2.5 w-2.5" />
        </button>
        <span>{{ paginationLabel }}</span>
        <button
          type="button"
          class="inline-flex items-center justify-center border-0 bg-transparent p-0 transition-opacity duration-150 disabled:cursor-default disabled:opacity-40"
          (click)="nextPage()"
          [disabled]="!canGoNext()"
          aria-label="Next page"
        >
          <img src="assets/icons/graph/pagination-chevron-right.svg" alt="" class="h-2.5 w-2.5" />
        </button>
      </div>
    </div>

    <div class="graph-panel__risk-card flex w-full flex-col gap-5 rounded-2xl border border-gray-2 bg-white px-7.5 py-2.5 shadow-medium">
      <h4 class="text-lg font-medium leading-146 text-gray-soft-500">Contextual Risk</h4>
      <div class="flex h-full items-center justify-between gap-5">
        <div class="flex flex-col gap-5">
          @for (item of riskSummary; track item.label) {
            <div
              class="graph-panel__risk-item flex items-center gap-2 text-base font-normal leading-146 text-night-blue"
              [class.graph-panel__risk-item--critical]="item.toneClass === 'graph-panel__risk-item--critical'"
              [class.graph-panel__risk-item--high]="item.toneClass === 'graph-panel__risk-item--high'"
              [class.graph-panel__risk-item--medium]="item.toneClass === 'graph-panel__risk-item--medium'"
              [class.graph-panel__risk-item--low]="item.toneClass === 'graph-panel__risk-item--low'"
            >
              <span class="text-base font-bold leading-146 text-night-blue">{{ item.count }}</span>
              <span class="text-base font-normal leading-146 text-night-blue capitalize">{{ item.label }}</span>
            </div>
          }
        </div>

        <div class="graph-panel__donut relative">
          <p-chart
            type="doughnut"
            [data]="riskChartData()"
            [options]="riskChartOptions"
            class="h-full w-full"
          />
          <div class="pointer-events-none absolute inset-0 flex items-center justify-center">
            <div class="text-2xl font-semibold leading-146 text-gray-7">
              {{ riskTotal() }}
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>
