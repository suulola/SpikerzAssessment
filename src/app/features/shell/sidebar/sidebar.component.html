<div class="relative group/sidebar-shell h-full">
  <aside class="flex flex-col bg-white rounded-md shadow-background-md transition-all duration-250 w-fit h-full">
    <div
      class="flex flex-col justify-between h-full py-7 px-4 overflow-y-hidden"
      [class.overflow-y-auto]="!collapsed()"
      [class.overflow-x-hidden]="!collapsed()"
      [class.md:overflow-y-visible]="collapsed()"
      [class.overflow-x-visible]="collapsed()"
    >
      <div class="flex flex-col gap-6">
        <div class="flex items-center" [class.justify-center]="collapsed()">
          <img
            src="assets/icons/sidebar/app-logo.svg"
            alt="App logo"
            class="h-7.5 w-7.5"
            [class.h-30.35]="collapsed()"
            [class.w-30.35]="collapsed()"
          />
        </div>
        <nav class="flex flex-col gap-1.5">
          @for (item of menuItems(); track item.id) {
          <button
            class="group/sidebar-item relative flex items-center gap-2 flex-1 py-2.5 px-3 rounded-sm border-none cursor-pointer transition-all duration-150 w-full text-left text-gray-soft-700"
            [class.bg-green-50]="isMenuItemSelected(item.id)"
            [class.text-green-900]="isMenuItemSelected(item.id)"
            [class.bg-transparent]="!isMenuItemSelected(item.id)"
            [class.hover:bg-gray-soft-50]="!isMenuItemSelected(item.id)"
            [class.justify-center]="collapsed()"
            (click)="onMenuItemClick(item)"
          >
            @if (isLucideIcon(item.icon)) {
              <lucide-icon
                [img]="item.icon"
                [size]="20"
                class="shrink-0 transition-colors duration-150"
                [class.text-green-900]="isMenuItemSelected(item.id)"
                [class.text-gray-soft-300]="!isMenuItemSelected(item.id)"
              ></lucide-icon>
            } @else {
              <span
                class="sidebar-icon w-5 h-5 shrink-0"
                [class.text-green-900]="isMenuItemSelected(item.id)"
                [class.text-gray-soft-300]="!isMenuItemSelected(item.id)"
                [style.--sidebar-icon]="'url(' + item.icon + ')'"
                aria-hidden="true"
              ></span>
            }
              @if (!collapsed()) {
                <span class="text-base font-normal tracking-base whitespace-nowrap transition-opacity duration-150">{{ item.label }}</span>
              }
              @if (collapsed()) {
                <span
                  class="pointer-events-none absolute left-full top-1/2 -translate-y-1/2 opacity-0 group-hover/sidebar-item:opacity-100 transition-opacity duration-150 bg-green-50 rounded-full py-1 px-2.5 text-base font-normal tracking-base text-green-900 whitespace-nowrap ml-2 z-10 shadow-drop-100"
                >
                  {{ item.label }}
                </span>
              }
            </button>
          }
        </nav>
      </div>

      <div class="flex flex-col gap-5">
        <nav class="flex flex-col gap-2">
          @for (item of secondaryMenuItems(); track item.id) {
          <button
            class="group/sidebar-item relative flex items-center gap-2 flex-1 py-2.5 px-3 rounded-sm border-none cursor-pointer transition-all duration-150 w-full text-left text-gray-soft-700"
            [class.bg-green-50]="isMenuItemSelected(item.id)"
            [class.text-green-900]="isMenuItemSelected(item.id)"
            [class.bg-transparent]="!isMenuItemSelected(item.id)"
            [class.hover:bg-gray-soft-50]="!isMenuItemSelected(item.id)"
            [class.justify-center]="collapsed()"
            (click)="onMenuItemClick(item)"
          >
            @if (isLucideIcon(item.icon)) {
              <lucide-icon
                [img]="item.icon"
                [size]="20"
                class="shrink-0 transition-colors duration-150"
                [class.text-green-900]="isMenuItemSelected(item.id)"
                [class.text-gray-soft-300]="!isMenuItemSelected(item.id)"
              ></lucide-icon>
            } @else {
              <span
                class="sidebar-icon w-5 h-5 shrink-0"
                [class.text-green-900]="isMenuItemSelected(item.id)"
                [class.text-gray-soft-300]="!isMenuItemSelected(item.id)"
                [style.--sidebar-icon]="'url(' + item.icon + ')'"
                aria-hidden="true"
              ></span>
            }
              @if (!collapsed()) {
                <span class="text-base font-normal tracking-base whitespace-nowrap transition-opacity duration-150">{{ item.label }}</span>
              }
              @if (collapsed()) {
                <span
                  class="pointer-events-none absolute left-full top-1/2 -translate-y-1/2 opacity-0 group-hover/sidebar-item:opacity-100 transition-opacity duration-150 bg-green-50 rounded-full py-1 px-2.5 text-base font-normal tracking-base text-green-900 whitespace-nowrap ml-2 z-10 shadow-drop-100"
                >
                  {{ item.label }}
                </span>
              }
            </button>
          }
        </nav>

        @if (!collapsed()) {
          <div class="w-full border-t border-gray-soft-10"></div>
        }

        <div class="flex flex-row justify-between items-center gap-3 pr-1">
          @if (!collapsed()) {
            <div class="flex items-center gap-3">
              @if (profile().avatar) {
                <img
                  [src]="profile().avatar"
                  [alt]="profile().name"
                  class="w-12 h-12 rounded-full object-cover shrink-0"
                />
              } @else {
                <div class="w-12 h-12 rounded-full bg-green-700 text-white flex items-center justify-center font-bold text-base shrink-0">
                  {{ getUserInitials() }}
                </div>
              }
              <div class="flex flex-col justify-center min-w-0 flex-1">
                <div class="text-base font-normal tracking-base whitespace-nowrap overflow-hidden text-ellipsis text-gray-soft-700">{{ profile().name }}</div>
                <div class="text-base font-normal tracking-base whitespace-nowrap overflow-hidden text-ellipsis text-gray-soft-700">{{ profile().role }}</div>
              </div>
            </div>
            <button
              class="w-18 h-18 border-none bg-transparent text-gray-soft-700 cursor-pointer flex items-center justify-center shrink-0 p-0 transition-opacity duration-150 hover:opacity-70"
              (click)="onLogout()"
            >
              <lucide-icon [img]="icons.LogOut" [size]="18" class="text-gray-soft-700"></lucide-icon>
            </button>
        } @else {
          @if (profile().avatar) {
            <img
              [src]="profile().avatar"
              [alt]="profile().name"
              class="w-36 h-36 rounded-full object-cover mx-auto"
            />
          } @else {
            <div class="w-12 h-12 rounded-full bg-green-700 text-white flex items-center justify-center font-bold text-base mx-auto">
              {{ getUserInitials() }}
            </div>
          }
        }
      </div>
      </div>
    </div>
  </aside>

  <button
    class="absolute top-7 right-0 translate-x-1/2 w-8 h-8 rounded-xl bg-green-800 border-3 border-gray-soft-50 shadow-drop-100 hidden md:flex items-center justify-center cursor-pointer transition-all duration-150 z-20 group-hover/sidebar-shell:opacity-100 group-hover/sidebar-shell:pointer-events-auto group-hover/sidebar-shell:scale-110 group-hover/sidebar-shell:shadow-drop-100"
    [class.opacity-100]="!collapsed()"
    [class.pointer-events-auto]="!collapsed()"
    [class.opacity-0]="collapsed()"
    [class.pointer-events-none]="collapsed()"
    [class.active:scale-95]="collapsed()"
    (click)="onToggle()"
  >
    <i class="pi text-white text-sm" [class.pi-chevron-left]="!collapsed()" [class.pi-chevron-right]="collapsed()"></i>
  </button>
</div>
